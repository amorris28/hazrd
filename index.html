<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Polygenic Hazard Score with Cox Proportional Hazards Model • hazrd</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Polygenic Hazard Score with Cox Proportional Hazards Model">
<meta name="description" content="Tools to compute polygenic hazard scores using Cox proportional hazards model and lasso regularization via glmnet.">
<meta property="og:description" content="Tools to compute polygenic hazard scores using Cox proportional hazards model and lasso regularization via glmnet.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">hazrd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/hazrd.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="hazrd">hazrd<a class="anchor" aria-label="anchor" href="#hazrd"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of hazrd is to simplify and standardize the development and testing of polygenic hazard score models in an opinionated way based mainly on past work in the <a href="https://github.com/cmig-research-group/phs" class="external-link">PHS repo</a>. Currently, most of the functionality focuses on external validation of PHS models. This includes calculation of standard statistics (80-20 hazard ratios, 80-20 odds ratios, and concordance index) and plotting of Kaplan-Meier curves and cumulative incidence curves. In the future, this will be expanded to model development, internal validation, imaging risk scores, multimodal hazard scores, and functions related to Digital Avatar.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="github">Github<a class="anchor" aria-label="anchor" href="#github"></a>
</h3>
<p>To install the most recent release from Github, go to the <a href="https://github.com/amorris28/hazrd/releases" class="external-link">release</a> page, scroll down to Assets, and download the “Source code (tar.gz)” file. Then, in <code>R</code>, run:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"hazrd-0.1.0.tar.gz"</span>, repos <span class="op">=</span> <span class="cn">NULL</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-devtools">Using <code>devtools</code>
<a class="anchor" aria-label="anchor" href="#using-devtools"></a>
</h3>
<p>For a more up-to-date installation with all of the changes since the last release, install the development version of hazrd from <a href="https://github.com/" class="external-link">GitHub</a> by cloning the repository:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">git</span> clone git@github.com:amorris28/hazrd.git</span></code></pre></div>
<p>and then opening <code>R</code> and installing the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"hazrd"</span><span class="op">)</span></span></code></pre></div>
<p>Replace <code>"hazrd"</code> with the path to the repository on your local computer.</p>
<div class="section level4">
<h4 id="on-a-remote-cluster">On a remote cluster<a class="anchor" aria-label="anchor" href="#on-a-remote-cluster"></a>
</h4>
<p>To install the development version on a remote cluster, such as TSD, build a tarball from your local clone of the Github repo:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build</span><span class="op">(</span><span class="st">"hazrd"</span><span class="op">)</span></span></code></pre></div>
<p>You can then install the <code>.tar.gz</code> with <code>install.packages</code> in <code>R</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"hazrd_0.1.0.tar.gz"</span>, repos <span class="op">=</span> <span class="cn">NULL</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>First, generate some test data. Here, we are using a simulated dataset that is included with the <code>hazrd</code> package.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://amorris28.github.io/hazrd/">hazrd</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20393440</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="do">##          phs      age status</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="do">## 1  0.8425735 67.95011      1</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="do">## 2  1.1151321 56.31356      0</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="do">## 3 -0.3777455 72.94103      1</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="do">## 4  0.1201511 82.01571      1</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="do">## 5 -0.4041602 74.33629      1</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="do">## 6 -0.4531890 77.15814      1</span></span></code></pre></div>
<p>Next, plot the histogram of PHSes by case/control status.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/phs_hist.html">phs_hist</a></span><span class="op">(</span><span class="va">test_data</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/phs_hist-1.png"><!-- --></p>
<p>Then, calculate the hazard ratio comparing the mean of the top 20% of PHSes to the mean of the bottom 20% (i.e., <code>HR80_20</code>). We can also generate 95% confidence intervals using bootstrapping.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HR80_20</span> <span class="op">=</span> <span class="fu"><a href="reference/get_hr.html">get_hr</a></span><span class="op">(</span><span class="va">test_data</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">HR80_20</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="do">## List of 5</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="do">##  $ index    : chr "HR80_20"</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="do">##  $ value    : num 8.17</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="do">##  $ conf.low : num 5.99</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="do">##  $ conf.high: num 11.4</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="do">##  $ iters    : num [1:300, 1] 8.35 9.71 8.24 10.2 8.54 ...</span></span></code></pre></div>
<p>Each <code>get_</code> function also returns the output from each bootstrap iteration in <code>$iters</code> so that the user can plot these or calculate their own confidence intervals:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">HR80_20</span><span class="op">$</span><span class="va">iters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">HR80_20</span><span class="op">$</span><span class="va">HR</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">HR80_20</span><span class="op">$</span><span class="va">conf.low</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">HR80_20</span><span class="op">$</span><span class="va">conf.high</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"HR80_20"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/HR_histogram-1.png"><!-- --></p>
<p>Similarly, calculate the odds ratio at age 70 between the top 20% and bottom 20% of PHSes.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OR80_20</span> <span class="op">=</span> <span class="fu"><a href="reference/get_or.html">get_or</a></span><span class="op">(</span><span class="va">test_data</span>, or_age <span class="op">=</span> <span class="fl">70</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">OR80_20</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="do">## List of 6</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="do">##  $ index    : chr "OR80_20"</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="do">##  $ value    : num 8.52</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="do">##  $ conf.low : num 4.92</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="do">##  $ conf.high: num 16.3</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="do">##  $ age      : num 70</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="do">##  $ iters    : num [1:300, 1] 7.37 11.7 15.78 9.29 6.26 ...</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">OR80_20</span><span class="op">$</span><span class="va">iters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">OR80_20</span><span class="op">$</span><span class="va">OR</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">OR80_20</span><span class="op">$</span><span class="va">conf.low</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">OR80_20</span><span class="op">$</span><span class="va">conf.high</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"OR80_20"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/OR_histogram-1.png"><!-- --></p>
<p>Return the concordance index with 95% confidence intervals from a coxph fit:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_index</span> <span class="op">=</span> <span class="fu"><a href="reference/get_cindex.html">get_cindex</a></span><span class="op">(</span><span class="va">test_data</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">c_index</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="do">## List of 5</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="do">##  $ index    : chr "C_Index"</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="do">##  $ value    : num 0.708</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="do">##  $ conf.low : num 0.683</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="do">##  $ conf.high: num 0.731</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="do">##  $ iters    : num [1:300, 1] 0.703 0.722 0.752 0.703 0.721 ...</span></span></code></pre></div>
<p>Finally, plot the Kaplan-Meier curves with confidence intervals for centiles of interest.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>curve0_20 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                    curve20_70 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>                    curve80_98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.98</span><span class="op">)</span>,</span>
<span>                    curve98_100 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.98</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">label_generator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PHS "</span>, <span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"th centile"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">curves</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">curven</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/km_curve.html">km_curve</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test_data</span>,  </span>
<span>                       interval <span class="op">=</span> <span class="va">curves</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                       age_range <span class="op">=</span> <span class="fl">40</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                       scale <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                       inverse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">curven</span><span class="op">$</span><span class="va">label</span> <span class="op">=</span> <span class="fu">label_generator</span><span class="op">(</span><span class="va">curves</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">curves</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="va">curven</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, </span>
<span>                      y <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">conf.low</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">conf.high</span>,</span>
<span>                      col <span class="op">=</span> <span class="va">label</span>,</span>
<span>                      fill <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                color <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                       name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                       name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="do">## Warning: Removed 15 rows containing missing values or values outside the scale range</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="do">## (`geom_step()`).</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/km_curve-1.png"><!-- --></p>
<div class="section level3">
<h3 id="individual-prediction">Individual Prediction<a class="anchor" aria-label="anchor" href="#individual-prediction"></a>
</h3>
<p>It is possible to generate a lookup table to perform individual prediction on a new, un-observed individual for which we have calculated a PHS score. To do this, we fit the model using our data and generate predicted curves for each of 99 percentiles (1 to 99%). We then output these curves with their associated PHS score at each percentile. This removes any connection to the subject-level data so is safe to export from secure computing platforms. We can then plot the prediction for the closest percentile to the new individual’s PHS</p>
<p>Future work will be to implement a way of interpolating the curve for a subject that is between two percentiles. In addition, work should be done to perform smoothing of the curve using the baseline hazard function rather than outputing a K-M curve for that individual. This will improve the interpretability of the individual prediction since risk isn’t likely to suddenly drop-off at a particular age, but should be an exponential function.</p>
<p>Here is an example workflow:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the lookup table (on a secure computing platform using</span></span>
<span><span class="co"># individual-level data)</span></span>
<span></span>
<span><span class="va">lookup_table</span> <span class="op">=</span> <span class="fu"><a href="reference/create_lookup_table.html">create_lookup_table</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span></code></pre></div>
<p>Export that lookup table from the computing platform and then identify the percentile for a new subject. Based on this toy dataset, a subject with a PHS of 1.6 would be approximately in the 94th percentile. Here, I plot the predicted curve for the median percentiel (50%) with a gray shaded area for the confidence intervals, an individual line for every percentile from 1 to 99, and I have highlighted in red the predicted risk curve and confidence intervals for the “new” hypothetical subject with a PHS of 1.6 (94th percentile):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">lookup_table</span><span class="op">[</span><span class="va">lookup_table</span><span class="op">$</span><span class="va">percentile</span> <span class="op">==</span> <span class="fl">0.50</span>, <span class="op">]</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, group <span class="op">=</span> <span class="va">percentile</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">lookup_table</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, group <span class="op">=</span> <span class="va">percentile</span><span class="op">)</span>, </span>
<span>                data <span class="op">=</span> <span class="va">lookup_table</span><span class="op">[</span><span class="va">lookup_table</span><span class="op">$</span><span class="va">percentile</span> <span class="op">==</span> <span class="fl">0.94</span>, <span class="op">]</span>, </span>
<span>                color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, </span>
<span>                data <span class="op">=</span> <span class="va">lookup_table</span><span class="op">[</span><span class="va">lookup_table</span><span class="op">$</span><span class="va">percentile</span> <span class="op">==</span> <span class="fl">0.94</span>, <span class="op">]</span>, </span>
<span>                alpha <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/plot_ind_pred-1.png"><!-- --></p>
</div>
</div>
<div class="section level2">
<h2 id="example-script">Example Script<a class="anchor" aria-label="anchor" href="#example-script"></a>
</h2>
<p>Here is an example script to run the entire hazrd analysis from the command line:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>Rscript hazrd_script.R phs.tsv metadata.tsv <span class="cn">FALSE</span> reports<span class="sc">/</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#########################################</span></span>
<span><span class="co"># First argument: PHS file</span></span>
<span><span class="co"># tab delimited file, with or without header, first column ID, second column PHS score</span></span>
<span><span class="co"># file basename used as prefix for output</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Second argument: metadata file</span></span>
<span><span class="co"># tab delimited file with or without header, first column id,  second column age, </span></span>
<span><span class="co"># third column status (0 or 1). Additional columns will be ignored.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Third argument: </span></span>
<span><span class="co"># boolean (i.e., TRUE or FALSE) indicating whether to inverse (x * -1) the PHS scores</span></span>
<span><span class="co"># to reverse the direction of effect.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Fourth argument:</span></span>
<span><span class="co"># path to output directory, e.g., "reports/"</span></span>
<span><span class="co"># if the directory does not exist it will be created</span></span>
<span></span>
<span><span class="co">########################################</span></span>
<span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://amorris28.github.io/hazrd/">hazrd</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co"># parse arguments</span></span>
<span></span>
<span><span class="va">args</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs</a></span><span class="op">(</span>trailingOnly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_file</span> <span class="op">=</span> <span class="va">args</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># PHS file</span></span>
<span></span>
<span><span class="co"># model = gsub("\\_.*","", basename(args[1])) # filename for output</span></span>
<span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\..*"</span>,<span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># filename for output</span></span>
<span></span>
<span><span class="va">metadata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"status"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Phenotype data</span></span>
<span></span>
<span><span class="va">inverse</span> <span class="op">=</span> <span class="va">args</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">=</span> <span class="va">args</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#########################################</span></span>
<span><span class="co"># Import PHS data</span></span>
<span></span>
<span><span class="va">phs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">model_file</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"phs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">phs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">phs</span><span class="op">$</span><span class="va">phs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">phs</span><span class="op">$</span><span class="va">phs</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">inverse</span><span class="op">)</span> <span class="op">{</span><span class="va">phs</span><span class="op">$</span><span class="va">phs</span> <span class="op">=</span> <span class="va">phs</span><span class="op">$</span><span class="va">phs</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span><span class="op">}</span></span>
<span></span>
<span><span class="va">combined_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="va">phs</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_data</span> <span class="op">=</span> <span class="va">combined_data</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">combined_data</span><span class="op">$</span><span class="va">phs</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co">#########################################</span></span>
<span><span class="co"># Analyze PHS data</span></span>
<span></span>
<span><span class="co"># PHS Histogram</span></span>
<span><span class="va">phs_hist</span> <span class="op">=</span> </span>
<span>    <span class="fu"><a href="reference/phs_hist.html">phs_hist</a></span><span class="op">(</span><span class="va">combined_data</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">model</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">model</span>, <span class="st">"_hist.png"</span><span class="op">)</span>, <span class="va">phs_hist</span>, </span>
<span>       units <span class="op">=</span> <span class="st">"px"</span>, height <span class="op">=</span> <span class="fl">1300</span>, width <span class="op">=</span> <span class="fl">1300</span>, create.dir <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Performance metrics</span></span>
<span></span>
<span></span>
<span><span class="va">HR80_20</span> <span class="op">=</span> <span class="fu"><a href="reference/get_hr.html">get_hr</a></span><span class="op">(</span><span class="va">combined_data</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">ages</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">70</span>, <span class="fl">80</span><span class="op">)</span></span>
<span><span class="va">OR80_20</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ages</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="reference/get_or.html">get_or</a></span><span class="op">(</span><span class="va">combined_data</span>, or_age <span class="op">=</span> <span class="va">x</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">c_index</span> <span class="op">=</span> <span class="fu"><a href="reference/get_cindex.html">get_cindex</a></span><span class="op">(</span><span class="va">combined_data</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span></span>
<span><span class="va">HR80_20</span><span class="op">$</span><span class="va">age</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="va">c_index</span><span class="op">$</span><span class="va">age</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="va">indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">HR80_20</span>, <span class="va">OR80_20</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">OR80_20</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">OR80_20</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">c_index</span><span class="op">)</span></span>
<span></span>
<span><span class="va">perform</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">indices</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">index</span>, </span>
<span>                                                                 value <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">value</span>, </span>
<span>                                                                 conf.low <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">conf.low</span>, </span>
<span>                                                                 conf.high <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">conf.high</span>, </span>
<span>                                                                 age <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">perform</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">perform</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">perform</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">model</span>, <span class="st">"_performance.tsv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># KM Curves</span></span>
<span><span class="va">curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>curve0_20 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                    curve20_70 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>                    curve80_98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.98</span><span class="op">)</span>,</span>
<span>                    curve98_100 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.98</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">label_generator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">y</span> <span class="op">=</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PHS "</span>, <span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"th centile"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">curves</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">curven</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/km_curve.html">km_curve</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">combined_data</span>,  </span>
<span>                     interval <span class="op">=</span> <span class="va">curves</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                     age_range <span class="op">=</span> <span class="fl">40</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                     scale <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                     inverse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">curven</span><span class="op">$</span><span class="va">label</span> <span class="op">=</span> <span class="fu">label_generator</span><span class="op">(</span><span class="va">curves</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">curves</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="va">curven</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">km_curve</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, </span>
<span>                      y <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">conf.low</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">conf.high</span>,</span>
<span>                      col <span class="op">=</span> <span class="va">label</span>,</span>
<span>                      fill <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>              color <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span>, title <span class="op">=</span> <span class="va">model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                     name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                    name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">model</span>, <span class="st">"_km_curve.png"</span><span class="op">)</span>, <span class="va">km_curve</span>,</span>
<span>       units <span class="op">=</span> <span class="st">"px"</span>, height <span class="op">=</span> <span class="fl">1300</span>, width <span class="op">=</span> <span class="fl">1600</span>, create.dir <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="developer-instructions">Developer Instructions<a class="anchor" aria-label="anchor" href="#developer-instructions"></a>
</h2>
<p>These are general instructions for how to create and document an R package.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"usethis"</span>, <span class="st">"devtools"</span>, <span class="st">"roxygen2"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>First, navigate to where you want to create the R package project directory. Open up an <code>R</code> console and run the <code>create_package</code> command. The first argument will be the name of the package and the name of the directory that is created within your current working directory.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">create_package</span><span class="op">(</span><span class="st">"my_package"</span><span class="op">)</span></span></code></pre></div>
<p>Next, navigate to your package directory (<code>cd my_package</code>) and develop your package by adding code to the <code>R/</code> directory. Here is a simple example of how to structure an <code>.R</code> script within the <code>R/</code> directory called <code>my_function.R</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' This is the Title of the Help Page for my_function</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This is a description of what this function does.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x Description of what the "x" parameter expects, default value, whether it is optional</span></span>
<span><span class="co">#' @param y Description of what the "y" parameter expects, etc.</span></span>
<span><span class="co">#' @return Description of what this function returns</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' my_results &lt;- my_function(x = 1, y = 2)</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="co"># Some code</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once you have created some files in the <code>R/</code> directory, you can automatically generate documentation using either <code>roxygen2::roxygenise</code> or <code>devtools::document</code>. <code>document</code> is generally preferred and actually calls <code>roxygenise</code> as part of its testing. You can either call it without any arguments from the root directory of your R package or you can specify the path to the package as the first argument.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="st">"path_to_your_package"</span><span class="op">)</span></span></code></pre></div>
<p>To verify there are no errors in the code or documentation, you can run <code>check</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>There is a <a href="https://stackoverflow.com/questions/63613301/r-cmd-check-note-unable-to-verify-current-time" class="external-link">known bug</a> where <code>check</code> returns 1 Note that says “unable to verify current time”. The workaround is to add <code>_R_CHECK_SYSTEM_CLOCK_=0</code> to your R environment file:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">edit_r_environ</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Resolve this and any other Errors, Warnings, and Notes that come up from <code>check</code>.</p>
<p>Finally, you can install the package locally using <code>devtools</code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"path_to_your_package"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing hazrd</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Andrew Morris <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/amorris28/hazRd/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/amorris28/hazRd/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrew Morris.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
