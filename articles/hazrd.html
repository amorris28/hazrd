<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with `{hazrd}` • hazrd</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with `{hazrd}`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hazrd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/hazrd.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with `{hazrd}`</h1>
            
      

      <div class="d-none name"><code>hazrd.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://amorris28.github.io/hazrd/">hazrd</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Here is our test data included in the package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;          phs      age status</span></span>
<span><span class="co">#&gt; 1  0.8425735 67.95011      1</span></span>
<span><span class="co">#&gt; 2  1.1151321 56.31356      0</span></span>
<span><span class="co">#&gt; 3 -0.3777455 72.94103      1</span></span>
<span><span class="co">#&gt; 4  0.1201511 82.01571      1</span></span>
<span><span class="co">#&gt; 5 -0.4041602 74.33629      1</span></span>
<span><span class="co">#&gt; 6 -0.4531890 77.15814      1</span></span></code></pre></div>
<p>Next, plot the histogram of PHSes by case/control status.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/phs_hist.html">phs_hist</a></span><span class="op">(</span><span class="va">test_data</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/phs_hist-1.png" width="384"></p>
<div class="section level3">
<h3 id="generating-test-statistics-and-confidence-intervals">Generating test statistics and confidence intervals<a class="anchor" aria-label="anchor" href="#generating-test-statistics-and-confidence-intervals"></a>
</h3>
<p>Then, calculate the hazard ratio comparing the mean of the top 20% of
PHSes to the mean of the bottom 20% (i.e., <code>HR80_20</code>). We can
also generate 95% confidence intervals using bootstrapping.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HR80_20</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span><span class="va">test_data</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">HR80_20</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "HR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 8.17</span></span>
<span><span class="co">#&gt;  $ conf.low : num 6.17</span></span>
<span><span class="co">#&gt;  $ conf.high: num 11.4</span></span>
<span><span class="co">#&gt;  $ iters    : num [1:300, 1] 6.35 8.38 6.43 6.65 7.32 ...</span></span></code></pre></div>
<p>Each <code>get_</code> function also returns the output from each
bootstrap iteration in <code>$iters</code> so that the user can plot
these or calculate their own confidence intervals:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">HR80_20</span><span class="op">$</span><span class="va">iters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">HR80_20</span><span class="op">$</span><span class="va">HR</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">HR80_20</span><span class="op">$</span><span class="va">conf.low</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">HR80_20</span><span class="op">$</span><span class="va">conf.high</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"HR80_20"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/HR_histogram-1.png" width="700"></p>
<p>Similarly, calculate the odds ratio at age 70 between the top 20% and
bottom 20% of PHSes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OR80_20</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_or.html">get_or</a></span><span class="op">(</span><span class="va">test_data</span>, or_age <span class="op">=</span> <span class="fl">70</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">OR80_20</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ index    : chr "OR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 8.52</span></span>
<span><span class="co">#&gt;  $ conf.low : num 4.53</span></span>
<span><span class="co">#&gt;  $ conf.high: num 17.1</span></span>
<span><span class="co">#&gt;  $ age      : num 70</span></span>
<span><span class="co">#&gt;  $ iters    : num [1:300, 1] 7.97 11.73 8.86 4.27 5.04 ...</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">OR80_20</span><span class="op">$</span><span class="va">iters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">OR80_20</span><span class="op">$</span><span class="va">OR</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">OR80_20</span><span class="op">$</span><span class="va">conf.low</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">OR80_20</span><span class="op">$</span><span class="va">conf.high</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"OR80_20"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/OR_histogram-1.png" width="700"></p>
<p>Return the concordance index with 95% confidence intervals from a
coxph fit:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_index</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_cindex.html">get_cindex</a></span><span class="op">(</span><span class="va">test_data</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">c_index</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "C_Index"</span></span>
<span><span class="co">#&gt;  $ value    : num 0.708</span></span>
<span><span class="co">#&gt;  $ conf.low : num 0.678</span></span>
<span><span class="co">#&gt;  $ conf.high: num 0.734</span></span>
<span><span class="co">#&gt;  $ iters    : num [1:300, 1] 0.713 0.718 0.71 0.714 0.695 ...</span></span></code></pre></div>
<p>Finally, plot the Kaplan-Meier curves with confidence intervals for
centiles of interest.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>curve0_20 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                    curve20_70 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>                    curve80_98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.98</span><span class="op">)</span>,</span>
<span>                    curve98_100 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.98</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">label_generator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PHS "</span>, <span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"th centile"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">curves</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">curven</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/km_curve.html">km_curve</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test_data</span>,  </span>
<span>                       interval <span class="op">=</span> <span class="va">curves</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                       age_range <span class="op">=</span> <span class="fl">40</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                       scale <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                       inverse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">curven</span><span class="op">$</span><span class="va">label</span> <span class="op">=</span> <span class="fu">label_generator</span><span class="op">(</span><span class="va">curves</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">curves</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="va">curven</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, </span>
<span>                      y <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">conf.low</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">conf.high</span>,</span>
<span>                      col <span class="op">=</span> <span class="va">label</span>,</span>
<span>                      fill <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                color <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                       name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                       name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 15 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_step()`).</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/plot_km_curves-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="more-advanced-topics">More advanced topics<a class="anchor" aria-label="anchor" href="#more-advanced-topics"></a>
</h2>
<div class="section level3">
<h3 id="data-format">Data format<a class="anchor" aria-label="anchor" href="#data-format"></a>
</h3>
<p>Each of the functions in this package (e.g., <code>get_hr</code>,
<code>get_or</code>, <code>phs_hist</code>, etc.) can accept data in
several formats. If your <code>data.frame</code> contains standard
columns <code>phs</code>, <code>age</code>, and <code>status</code>,
then you can simply pass the data.frame object to the
<code>data =</code> argument:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "HR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 8.17</span></span>
<span><span class="co">#&gt;  $ conf.low : NULL</span></span>
<span><span class="co">#&gt;  $ conf.high: NULL</span></span>
<span><span class="co">#&gt;  $ iters    : NULL</span></span></code></pre></div>
<p>If your data is stored in a data.frame with non-standard column
names, e.g., <code>HazardScores</code>, <code>CaseControl</code>, and
<code>AgeLastObs</code>,</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_data2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>HazardScores <span class="op">=</span> <span class="va">phs</span>, </span>
<span>                                        CaseControl <span class="op">=</span> <span class="va">status</span>, </span>
<span>                                        AgeLastObs <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test_data2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   HazardScores CaseControl AgeLastObs</span></span>
<span><span class="co">#&gt; 1    0.8425735           1   67.95011</span></span>
<span><span class="co">#&gt; 2    1.1151321           0   56.31356</span></span>
<span><span class="co">#&gt; 3   -0.3777455           1   72.94103</span></span>
<span><span class="co">#&gt; 4    0.1201511           1   82.01571</span></span>
<span><span class="co">#&gt; 5   -0.4041602           1   74.33629</span></span>
<span><span class="co">#&gt; 6   -0.4531890           1   77.15814</span></span></code></pre></div>
<p>then you can specify these column names as separate arguments:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test_data2</span>, </span>
<span>       phs <span class="op">=</span> <span class="st">"HazardScores"</span>, </span>
<span>       status <span class="op">=</span> <span class="st">"CaseControl"</span>, </span>
<span>       age <span class="op">=</span> <span class="st">"AgeLastObs"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "HR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 8.17</span></span>
<span><span class="co">#&gt;  $ conf.low : NULL</span></span>
<span><span class="co">#&gt;  $ conf.high: NULL</span></span>
<span><span class="co">#&gt;  $ iters    : NULL</span></span></code></pre></div>
<p>If any of your data is not in a data.frame, but is instead in
separate vectors, you can provide these individually by name:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hazScore</span> <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">phs</span></span>
<span><span class="va">caseCon</span> <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="va">ageLastObs</span> <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">age</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span>phs <span class="op">=</span> <span class="va">hazScore</span>, </span>
<span>       status <span class="op">=</span> <span class="va">caseCon</span>, </span>
<span>       age <span class="op">=</span> <span class="va">ageLastObs</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "HR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 8.17</span></span>
<span><span class="co">#&gt;  $ conf.low : NULL</span></span>
<span><span class="co">#&gt;  $ conf.high: NULL</span></span>
<span><span class="co">#&gt;  $ iters    : NULL</span></span></code></pre></div>
<p>Lastly, you can do any combination of the above:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_data3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>phs <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">phs</span>,</span>
<span>                        CaseControl <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="va">Ages</span> <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">age</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test_data3</span>,</span>
<span>       <span class="co">#phs = "phs", # omitted because test_data3 already contains column "phs"</span></span>
<span>       status <span class="op">=</span> <span class="st">"CaseControl"</span>, </span>
<span>       age <span class="op">=</span> <span class="va">Ages</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "HR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 8.17</span></span>
<span><span class="co">#&gt;  $ conf.low : NULL</span></span>
<span><span class="co">#&gt;  $ conf.high: NULL</span></span>
<span><span class="co">#&gt;  $ iters    : NULL</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hazard-ratios-and-odds-ratios">Hazard ratios and odds ratios<a class="anchor" aria-label="anchor" href="#hazard-ratios-and-odds-ratios"></a>
</h3>
<div class="section level4">
<h4 id="specifying-intervals">Specifying intervals<a class="anchor" aria-label="anchor" href="#specifying-intervals"></a>
</h4>
<p>The <code>get_hr</code> function allows several options for
customizing your hazard ratios. By default, it calculates the
<code>HR80_20</code>, which compares the top 20% of PHSes to the bottom
20%. However, custom intervals can be specified using the
<code>upper_interval</code> and <code>lower_interval</code>
arguments.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span><span class="va">test_data</span>,</span>
<span>       lower_interval <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>       upper_interval <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "HR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 8.17</span></span>
<span><span class="co">#&gt;  $ conf.low : NULL</span></span>
<span><span class="co">#&gt;  $ conf.high: NULL</span></span>
<span><span class="co">#&gt;  $ iters    : NULL</span></span></code></pre></div>
<p>These are the default arguments. If one value is passed to
<code>upper_interval</code> then it calculates the hazard ratio for the
interval <code>0.8:Inf</code>. Similarly, <code>lower_interval</code>
will use <code>-Inf:0.2</code>. However, two values can be specified as
a vector to specify a particular range. For example, if you want the
lower interval to be the middle 40% of PHSes, you can specify
<code>lower_interval = c(0.3, 0.7)</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span><span class="va">test_data</span>,</span>
<span>       lower_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>       upper_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr [1:2] "HR80_30" "HRInf_70"</span></span>
<span><span class="co">#&gt;  $ value    : num 3.04</span></span>
<span><span class="co">#&gt;  $ conf.low : NULL</span></span>
<span><span class="co">#&gt;  $ conf.high: NULL</span></span>
<span><span class="co">#&gt;  $ iters    : NULL</span></span></code></pre></div>
<p>interval specifications are the same for odds ratios from
<code>get_or</code> as for <code>get_hr</code>. The only difference is
that the odds ratio must be calculated at a particular age, which is
passed with the <code>or_age</code> argument:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_or.html">get_or</a></span><span class="op">(</span><span class="va">test_data</span>,</span>
<span>       or_age <span class="op">=</span> <span class="fl">70</span>,</span>
<span>       lower_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>       upper_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ index    : chr [1:2] "OR80_30" "ORInf_70"</span></span>
<span><span class="co">#&gt;  $ value    : num 3.83</span></span>
<span><span class="co">#&gt;  $ conf.low : NULL</span></span>
<span><span class="co">#&gt;  $ conf.high: NULL</span></span>
<span><span class="co">#&gt;  $ age      : num 70</span></span>
<span><span class="co">#&gt;  $ iters    : NULL</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="confidence-intervals-from-bootstrapping">Confidence intervals from bootstrapping<a class="anchor" aria-label="anchor" href="#confidence-intervals-from-bootstrapping"></a>
</h4>
<p>95% confidence intervals for the estimates from the
<code>get_hr</code>, <code>get_or</code>, and <code>get_cindex</code>
functions can be generated by bootstrapping. This is done by by
specifying <code>CI = TRUE</code> and providing a number of bootstrap
iterations with <code>bootstrap_iterations =</code>. In this case,
<code>get_hr</code> returns a list containing the hazard ratio and the
values for the upper and lower 95% confidence intervals as well as all
of the HR estimates from each bootstrap iteration in
<code>iters</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span><span class="va">test_data</span>,</span>
<span>       CI <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       bootstrap_iterations <span class="op">=</span> <span class="fl">300</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "HR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 8.17</span></span>
<span><span class="co">#&gt;  $ conf.low : num 6.1</span></span>
<span><span class="co">#&gt;  $ conf.high: num 11.1</span></span>
<span><span class="co">#&gt;  $ iters    : num [1:300, 1] 7.77 8.21 7.5 9.34 9.75 ...</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-weight-correction">Sample weight correction<a class="anchor" aria-label="anchor" href="#sample-weight-correction"></a>
</h4>
<p>This is an experimental feature and hasn’t been tested. If you wish
to perform sample weight correction for HR, OR or C-Index, you can
enable it with the flag <code>swc = TRUE</code>. You must provide the
population number of cases and the population number of controls to
perform sample weight correction. These are provided with the
<code>swc_popnumcases</code> and <code>swc_popnumcontrols</code>
arguments.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span><span class="va">test_data</span>,</span>
<span>       swc <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       swc_popnumcases <span class="op">=</span> <span class="fl">28421</span>,</span>
<span>       swc_popnumcontrols <span class="op">=</span> <span class="fl">398475</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ index    : chr "HR80_20"</span></span>
<span><span class="co">#&gt;  $ value    : num 17.1</span></span>
<span><span class="co">#&gt;  $ conf.low : NULL</span></span>
<span><span class="co">#&gt;  $ conf.high: NULL</span></span>
<span><span class="co">#&gt;  $ iters    : NULL</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="plotting-curves">Plotting curves<a class="anchor" aria-label="anchor" href="#plotting-curves"></a>
</h3>
<p>To plot Kaplan-Meier curves, you can use the <code>km_curve</code>
function to return a single Kaplan-Meier curve for a given interval.
Plotting must be performed manually once you have returned these
curves.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curven</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/km_curve.html">km_curve</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test_data</span>,  </span>
<span>                       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.80</span>, <span class="fl">1.00</span><span class="op">)</span>, </span>
<span>                       age_range <span class="op">=</span> <span class="fl">40</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                       scale <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                       inverse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><code>interval</code> specifies the lower and upper quantile of the
interval. In this case, the K-M curve for the top 20% of samples
(<code>0.8:1.0</code>) will be returned. In addition,
<code>age_range</code> specifies the ages over which the curve should be
generated. Can be on the order of <code>40:100</code> for
age-at-diagnosis or similar. Alternatively, can be <code>0:10</code>
for, for exmaple, age of conversion to AD after MCI diagnosis.</p>
<p>We can generate multiple curves at various intervals and get them
into a data.frame:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>curve0_20 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                    curve20_70 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>                    curve80_98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.98</span><span class="op">)</span>,</span>
<span>                    curve98_100 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.98</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">label_generator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PHS "</span>, <span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"th centile"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">curves</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">curven</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/km_curve.html">km_curve</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test_data</span>,  </span>
<span>                       interval <span class="op">=</span> <span class="va">curves</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                       age_range <span class="op">=</span> <span class="fl">40</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                       scale <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                       inverse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">curven</span><span class="op">$</span><span class="va">label</span> <span class="op">=</span> <span class="fu">label_generator</span><span class="op">(</span><span class="va">curves</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">curves</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="va">curven</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And plot them:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, </span>
<span>                      y <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">conf.low</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">conf.high</span>,</span>
<span>                      col <span class="op">=</span> <span class="va">label</span>,</span>
<span>                      fill <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                color <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                       name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                       name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 15 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_step()`).</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/plot_km_curves2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="individual-prediction">Individual Prediction<a class="anchor" aria-label="anchor" href="#individual-prediction"></a>
</h3>
<p>It is possible to generate a lookup table to perform individual
prediction on a new, un-observed individual for which we have calculated
a PHS score. To do this, we fit the model using our data and generate
predicted curves for each of 99 percentiles (1 to 99%). We then output
these curves with their associated PHS score at each percentile. This
removes any connection to the subject-level data so is safe to export
from secure computing platforms. We can then plot the prediction for the
closest percentile to the new individual’s PHS</p>
<p>Here is an example workflow:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the lookup table (on a secure computing platform using</span></span>
<span><span class="co"># individual-level data)</span></span>
<span></span>
<span><span class="va">lookup_table</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_lookup_table.html">create_lookup_table</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span></code></pre></div>
<p>Export that lookup table from the computing platform and then
identify the percentile for a new subject. Based on this toy dataset, a
subject with a PHS of 1.6 would be approximately in the 94th percentile.
Here, I plot the predicted curve for the median percentiel (50%) with a
gray shaded area for the confidence intervals, an individual line for
every percentile from 1 to 99, and I have highlighted in red the
predicted risk curve and confidence intervals for the “new” hypothetical
subject with a PHS of 1.6 (94th percentile):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">lookup_table</span><span class="op">[</span><span class="va">lookup_table</span><span class="op">$</span><span class="va">percentile</span> <span class="op">==</span> <span class="fl">0.50</span>, <span class="op">]</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, group <span class="op">=</span> <span class="va">percentile</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">lookup_table</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, group <span class="op">=</span> <span class="va">percentile</span><span class="op">)</span>, </span>
<span>                data <span class="op">=</span> <span class="va">lookup_table</span><span class="op">[</span><span class="va">lookup_table</span><span class="op">$</span><span class="va">percentile</span> <span class="op">==</span> <span class="fl">0.94</span>, <span class="op">]</span>, </span>
<span>                color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, </span>
<span>                data <span class="op">=</span> <span class="va">lookup_table</span><span class="op">[</span><span class="va">lookup_table</span><span class="op">$</span><span class="va">percentile</span> <span class="op">==</span> <span class="fl">0.94</span>, <span class="op">]</span>, </span>
<span>                alpha <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/plot_ind_pred-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="percentiles-versus-quintiles-for-comparison-and-prediction">Percentiles versus Quintiles for comparison and prediction<a class="anchor" aria-label="anchor" href="#percentiles-versus-quintiles-for-comparison-and-prediction"></a>
</h2>
<p>In the literature on PHS, there are at least two ways that folks
visualize the survival estimates for different PHS models. One is to
compare the 20th percentile to the 80th percentile. The other is to
compare quintiles, that is, the top 20% of PHSes to the bottom 20%. Here
is an explanation of how to do both and how those estimates compare:</p>
<div class="section level3">
<h3 id="percentiles">Percentiles<a class="anchor" aria-label="anchor" href="#percentiles"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="co"># Fit the coxph model</span></span>
<span><span class="va">cp_fit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">phs</span>, data <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the PHS at each percentile of interest</span></span>
<span><span class="va">phs0.2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">phs</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">phs0.8</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">phs</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">phs0.5</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">phs</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Generate some new data for prediction using these PHS scores</span></span>
<span><span class="va">new_data0.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         age <span class="op">=</span> <span class="fl">40</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>                         phs <span class="op">=</span> <span class="va">phs0.2</span><span class="op">)</span></span>
<span><span class="va">new_data0.8</span> <span class="op">=</span> <span class="va">new_data0.2</span></span>
<span><span class="va">new_data0.8</span><span class="op">$</span><span class="va">phs</span> <span class="op">=</span> <span class="va">phs0.8</span></span>
<span><span class="va">new_data0.5</span> <span class="op">=</span> <span class="va">new_data0.2</span></span>
<span><span class="va">new_data0.5</span><span class="op">$</span><span class="va">phs</span> <span class="op">=</span> <span class="va">phs0.5</span></span>
<span></span>
<span><span class="co"># Using our original model, generate a predicted survival curve</span></span>
<span><span class="va">cp_predict_0.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cp_fit</span>, <span class="va">new_data0.2</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span><span class="va">cp_predict_0.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cp_fit</span>, <span class="va">new_data0.8</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span><span class="va">cp_predict_0.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cp_fit</span>, <span class="va">new_data0.5</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0.2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0.2</span>, color <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0.8</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0.8</span>, color <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0.5</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0.5</span>, color <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Here, the blue line is the 20th percentile, the green line is the
50th percentile, and the red line is the 80th percentile.</p>
</div>
<div class="section level3">
<h3 id="quintiles">Quintiles<a class="anchor" aria-label="anchor" href="#quintiles"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cut the PHSes into groups based on percentile.</span></span>
<span><span class="co"># Here, we are splitting them into 0-20%, 20-80%, and 80-100%</span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">phs_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">phs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="va">phs0.2</span>, <span class="va">phs0.8</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0-20"</span>, <span class="st">"20-80"</span>, <span class="st">"80-100"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model, this time with group as the predictor rather than the PHS</span></span>
<span><span class="va">cp_fit_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">phs_group</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate some new data for prediction</span></span>
<span><span class="va">new_data0020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           age <span class="op">=</span> <span class="fl">40</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>                           phs_group <span class="op">=</span> <span class="st">"0-20"</span><span class="op">)</span></span>
<span><span class="va">new_data2080</span> <span class="op">&lt;-</span> <span class="va">new_data0020</span></span>
<span><span class="va">new_data2080</span><span class="op">$</span><span class="va">phs_group</span> <span class="op">=</span> <span class="st">"20-80"</span></span>
<span><span class="va">new_data80100</span> <span class="op">&lt;-</span> <span class="va">new_data0020</span></span>
<span><span class="va">new_data80100</span><span class="op">$</span><span class="va">phs_group</span> <span class="op">=</span> <span class="st">"80-100"</span></span>
<span></span>
<span><span class="co"># Generate a predicted survival curve</span></span>
<span><span class="va">cp_predict_0020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cp_fit_group</span>, <span class="va">new_data0020</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span><span class="va">cp_predict_2080</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cp_fit_group</span>, <span class="va">new_data2080</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span><span class="va">cp_predict_80100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cp_fit_group</span>, <span class="va">new_data80100</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the curves for each group</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0020</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0020</span>, color <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_80100</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data80100</span>, color <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_2080</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data2080</span>, color <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Here, the blue line is the survival curve for the bottom 20% of
PHSes, the green line is the survival curve for the middle 60% of PHSes
(20-80%), and the red line is the survival curve for the top 20% of
PHSes.</p>
<p>Lastly, we can compare these two approaches and see how they generate
different survival curves:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0020</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0020</span>, color <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_2080</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data2080</span>, color <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_80100</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data80100</span>, color <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0.2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0.2</span>, color <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0.8</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0.8</span>, color <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0.5</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0.5</span>, color <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hazrd_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Here, the blue curves are the quintile curves or group-based curves
and the red curves are the percentile-based curves.</p>
<p>The 0-20 and 80-100 curves are close to but not exactly the same as
the 10% percentile and the 90% percentile:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phs0.1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">phs</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">phs0.9</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">phs</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_data0.1</span> <span class="op">=</span> <span class="va">new_data0.2</span></span>
<span><span class="va">new_data0.1</span><span class="op">$</span><span class="va">phs</span> <span class="op">=</span> <span class="va">phs0.1</span></span>
<span><span class="va">new_data0.9</span> <span class="op">=</span> <span class="va">new_data0.2</span></span>
<span><span class="va">new_data0.9</span><span class="op">$</span><span class="va">phs</span> <span class="op">=</span> <span class="va">phs0.9</span></span>
<span><span class="va">cp_predict_0.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cp_fit</span>, <span class="va">new_data0.1</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span><span class="va">cp_predict_0.9</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cp_fit</span>, <span class="va">new_data0.9</span>, type <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0020</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0020</span>, color <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_2080</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data2080</span>, color <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_80100</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data80100</span>, color <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0.1</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0.1</span>, color <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>  <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cp_predict_0.9</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">new_data0.9</span>, color <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> </span></code></pre></div>
<p><img src="hazrd_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>Here again the blue curves are the group-based curves (0-20, 20-80,
and 80-100%) and the pink curves are the prediction for the 10th
percentile and the 90th percentile.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-script">Example Script<a class="anchor" aria-label="anchor" href="#example-script"></a>
</h2>
<p>Here is an example script to run the entire hazrd analysis from the
command line:</p>
<pre><code>Rscript hazrd_script.R phs.tsv metadata.tsv FALSE reports/</code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#########################################</span></span>
<span><span class="co"># First argument: PHS file</span></span>
<span><span class="co"># tab delimited file, with or without header, first column ID, second column PHS score</span></span>
<span><span class="co"># file basename used as prefix for output</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Second argument: metadata file</span></span>
<span><span class="co"># tab delimited file with or without header, first column id,  second column age, </span></span>
<span><span class="co"># third column status (0 or 1). Additional columns will be ignored.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Third argument: </span></span>
<span><span class="co"># boolean (i.e., TRUE or FALSE) indicating whether to inverse (x * -1) the PHS scores</span></span>
<span><span class="co"># to reverse the direction of effect.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Fourth argument:</span></span>
<span><span class="co"># path to output directory, e.g., "reports/"</span></span>
<span><span class="co"># if the directory does not exist it will be created</span></span>
<span></span>
<span><span class="co">########################################</span></span>
<span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://amorris28.github.io/hazrd/">hazrd</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co"># parse arguments</span></span>
<span></span>
<span><span class="va">args</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs</a></span><span class="op">(</span>trailingOnly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_file</span> <span class="op">=</span> <span class="va">args</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># PHS file</span></span>
<span></span>
<span><span class="co"># model = gsub("\\_.*","", basename(args[1])) # filename for output</span></span>
<span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\..*"</span>,<span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># filename for output</span></span>
<span></span>
<span><span class="va">metadata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"status"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Phenotype data</span></span>
<span></span>
<span><span class="va">inverse</span> <span class="op">=</span> <span class="va">args</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">=</span> <span class="va">args</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#########################################</span></span>
<span><span class="co"># Import PHS data</span></span>
<span></span>
<span><span class="va">phs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">model_file</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"phs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">phs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">phs</span><span class="op">$</span><span class="va">phs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">phs</span><span class="op">$</span><span class="va">phs</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">inverse</span><span class="op">)</span> <span class="op">{</span><span class="va">phs</span><span class="op">$</span><span class="va">phs</span> <span class="op">=</span> <span class="va">phs</span><span class="op">$</span><span class="va">phs</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span><span class="op">}</span></span>
<span></span>
<span><span class="va">combined_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="va">phs</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_data</span> <span class="op">=</span> <span class="va">combined_data</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">combined_data</span><span class="op">$</span><span class="va">phs</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co">#########################################</span></span>
<span><span class="co"># Analyze PHS data</span></span>
<span></span>
<span><span class="co"># PHS Histogram</span></span>
<span><span class="va">phs_hist</span> <span class="op">=</span> </span>
<span>    <span class="fu"><a href="../reference/phs_hist.html">phs_hist</a></span><span class="op">(</span><span class="va">combined_data</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">model</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">model</span>, <span class="st">"_hist.png"</span><span class="op">)</span>, <span class="va">phs_hist</span>, </span>
<span>       units <span class="op">=</span> <span class="st">"px"</span>, height <span class="op">=</span> <span class="fl">1300</span>, width <span class="op">=</span> <span class="fl">1300</span>, create.dir <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Performance metrics</span></span>
<span></span>
<span></span>
<span><span class="va">HR80_20</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_hr.html">get_hr</a></span><span class="op">(</span><span class="va">combined_data</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">ages</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">70</span>, <span class="fl">80</span><span class="op">)</span></span>
<span><span class="va">OR80_20</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ages</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="../reference/get_or.html">get_or</a></span><span class="op">(</span><span class="va">combined_data</span>, or_age <span class="op">=</span> <span class="va">x</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">c_index</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_cindex.html">get_cindex</a></span><span class="op">(</span><span class="va">combined_data</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boot <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span></span>
<span><span class="va">HR80_20</span><span class="op">$</span><span class="va">age</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="va">c_index</span><span class="op">$</span><span class="va">age</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="va">indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">HR80_20</span>, <span class="va">OR80_20</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">OR80_20</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">OR80_20</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">c_index</span><span class="op">)</span></span>
<span></span>
<span><span class="va">perform</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">indices</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">index</span>, </span>
<span>                                                                 value <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">value</span>, </span>
<span>                                                                 conf.low <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">conf.low</span>, </span>
<span>                                                                 conf.high <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">conf.high</span>, </span>
<span>                                                                 age <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">perform</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">perform</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">perform</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">model</span>, <span class="st">"_performance.tsv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># KM Curves</span></span>
<span><span class="va">curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>curve0_20 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                    curve20_70 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>                    curve80_98 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.98</span><span class="op">)</span>,</span>
<span>                    curve98_100 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.98</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">label_generator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">y</span> <span class="op">=</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PHS "</span>, <span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"th centile"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">curves</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">curven</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/km_curve.html">km_curve</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">combined_data</span>,  </span>
<span>                     interval <span class="op">=</span> <span class="va">curves</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                     age_range <span class="op">=</span> <span class="fl">40</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                     scale <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                     inverse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">curven</span><span class="op">$</span><span class="va">label</span> <span class="op">=</span> <span class="fu">label_generator</span><span class="op">(</span><span class="va">curves</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">curves</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">km_curves</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="va">curven</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">km_curve</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">km_curves</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, </span>
<span>                      y <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">conf.low</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">conf.high</span>,</span>
<span>                      col <span class="op">=</span> <span class="va">label</span>,</span>
<span>                      fill <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>              color <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age"</span>, y <span class="op">=</span> <span class="st">"Disease-free Survival"</span>, title <span class="op">=</span> <span class="va">model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                     name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>                    name <span class="op">=</span> <span class="st">"Centile"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">model</span>, <span class="st">"_km_curve.png"</span><span class="op">)</span>, <span class="va">km_curve</span>,</span>
<span>       units <span class="op">=</span> <span class="st">"px"</span>, height <span class="op">=</span> <span class="fl">1300</span>, width <span class="op">=</span> <span class="fl">1600</span>, create.dir <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrew Morris.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
